<!DOCTYPE html>
<html>
<head>
  <title>Exam Block Finder</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 40px;
    }
    input, button {
      padding: 10px;
      margin: 10px;
    }
    #results {
      margin-top: 30px;
      display: none;
    }
    .result-card {
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 10px;
      width: 320px;
      margin: 15px auto;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
    }
    #college-logo {
      width: 120px;
      height: auto;
      margin-bottom: 10px;
    }
    #college-name {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 20px;
    }
    .time {
      color: red;
      font-weight: bold;
    }
    footer {
      margin-top: 50px;
      font-size: 1em;
      font-weight: bold;
      color: #333;
    }
  </style>
</head>
<body>

  <img src="logo.png" alt="College Logo" id="college-logo" />
  <div id="college-name">Sangamner Nagarpalika Arts, D J Malpani Commerce & B N Sarda Science College (Autonomous), Sangamner</div>

  <h1>Find Your Exam Block</h1>
  <input type="text" id="seatNo" placeholder="Enter Seat Number" />
  <input type="date" id="examDate" />
  <br>
  <button onclick="findStudent()">Submit</button>

  <div id="results"></div>

  <footer>
    &copy; 2025 ajitkaranjekar@sangamnercollege.edu.in
  </footer>

  <script>
    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTLWAt7sXY_iv_GBv9S7YdN4TkH7Wy_zQq9d1D9ItxGchX7O81sO5NKc2KhD5PnpdAPTcbG7tCooRXa/pub?output=csv";

    const buildingNames = {
      "PB": "Parakh Bhavan",
      "KB": "Kashalya Bhavan",
      "RB": "Research Building",
      "PH": "Physics Building",
      "CM": "Commerce Building",
      "CS": "Computer Science",
      "BEd": "B.Ed. Building",
      "SC": "Science Building",
      "LAW": "Law College"
    };

    const buildingMapLinks = {
      "PB": "https://maps.app.goo.gl/95EhvGe1MbxkAaYo6",
      "KB": "https://maps.app.goo.gl/Qr3EHj2n9n8ihdJV6",
      "RB": "https://maps.app.goo.gl/tNejbMhUYANjxXnRA",
      "PH": "https://maps.app.goo.gl/HsWbkh2ALnSV82dAA",
      "CM": "https://maps.app.goo.gl/jNMzzjPQ76ycuPhn7",
      "CS": "https://maps.app.goo.gl/rFTkxD2hg6v1tYJS7",
      "BEd": "https://maps.app.goo.gl/rFTkxD2hg6v1tYJS7",
      "SC": "https://maps.app.goo.gl/dPnCS6jUWUNRxAdF7",
      "LAW": "https://maps.app.goo.gl/4KWi7pgzgicfm4Vq9"
    };

    let studentData = [];

    function formatDateToDDMMYYYY(dateStr) {
      const parts = dateStr.split("-");
      return `${parts[2]}-${parts[1]}-${parts[0]}`;
    }

    function loadStudentData(callback) {
      Papa.parse(sheetURL, {
        download: true,
        header: true,
        complete: function(results) {
          studentData = results.data;
          callback();
        }
      });
    }

    function findStudent() {
      const seatNoInput = document.getElementById("seatNo").value.trim().toUpperCase();
      const examDateInput = document.getElementById("examDate").value;

      if (!seatNoInput || !examDateInput) {
        alert("Please enter Seat Number and Exam Date");
        return;
      }

      const formattedDate = formatDateToDDMMYYYY(examDateInput);

      if (studentData.length === 0) {
        loadStudentData(() => matchStudents(seatNoInput, formattedDate));
      } else {
        matchStudents(seatNoInput, formattedDate);
      }
    }

    function matchStudents(seatNo, examDate) {
      const matches = studentData.filter(
        s => s.SeatNo.toUpperCase() === seatNo && s.ExamDate === examDate
      );

      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";

      if (matches.length > 0) {
        matches.forEach(student => {
          const buildingCode = student.Building.trim();
          const buildingFullName = buildingNames[buildingCode] || buildingCode;
          const blockInfo = `${buildingCode}-${student.Block}`;
          const timeInfo = student.Time || "Not available";

          const card = document.createElement("div");
          card.classList.add("result-card");

          card.innerHTML = `
            <h2>${student.Name}</h2>
            <p><strong>Seat No:</strong> ${student.SeatNo}</p>
            <p><strong>Building:</strong> ${buildingFullName}</p>
            <p><strong>Block:</strong> ${blockInfo}</p>
            <p><strong>Time:</strong> <span class="time">${timeInfo}</span></p>
            <button onclick="openMap('${buildingCode}')">View on Google Map</button>
          `;
          resultsDiv.appendChild(card);
        });
        resultsDiv.style.display = "block";
      } else {
        alert("No record found. Please check the seat number or date.");
        resultsDiv.style.display = "none";
      }
    }

    function openMap(buildingCode) {
      const mapURL = buildingMapLinks[buildingCode];
      if (mapURL) {
        window.open(mapURL, "_blank");
      } else {
        alert("Map location for this building is not available.");
      }
    }
  </script>
</body>
</html>
